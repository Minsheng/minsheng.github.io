<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <title>MR Navi Demo</title>
    </head>
    <body>
        <div id="currentLat"></div>
        <div id="currentLon"></div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
        <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.0.5.js"></script>
        <script type="text/javascript">
            // this function will be executed when the page is loaded
            
            var options = {
                timeout: (5 * 1000),
                maximumAge: 0,
                enableHighAccuracy: true
            };

            window.addEventListener("deviceorientation", handleOrient, true);

            function handleOrient(event) {
                var x = event.beta ? event.beta : event.y * 90;
                var y = event.gamma ? event.gamma : event.x * 90;

                // Try HTML5 geolocation.
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(success, function() {
                        handleLocationError(true);
                    }, options);
                } else {
                    // Browser doesn't support Geolocation
                    handleLocationError(false);
                }

                // the argument position contains the coordinate of the current user
                function success(position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    // updating the coordinate information on the html page
                    document.getElementById('currentLat').innerHTML = pos.lat;
                    document.getElementById('currentLon').innerHTML = pos.lng;

                    console.log("Your current loc: " + pos.lat + " , " + pos.lng);

                    // set up pubnub authentication so the client can publish and subscribe through pubnub channel
                    // var pubnub = new PubNub({
                    //     subscribeKey: "sub-c-441be6a2-5d04-11e6-ada4-02ee2ddab7fe",
                    //     publishKey: "pub-c-d223f6bb-65ab-4128-b272-3984970759c1",
                    //     uuid: name,
                    //     ssl: true
                    // });

                    // // publish the coordinate through a channel
                    // pubnub.publish({
                    //     channel  : 'mr-demo',
                    //     message  : {
                    //         uuid : pubnub.getUUID(), // get the user id
                    //         type : 'geo',
                    //         position : pos ? pos : "not found" // if coordinate not identified return a placeholder
                    //     },
                    //     callback : function(m){
                    //         console.log(m)
                    //     }
                    // });

                    // // handle any message that's been published through the channel
                    // pubnub.addListener({
                    //     message: function(message) {
                    //         // handle incoming messages
                    //         console.log(message);
                    //     },
                    //     presence: function(presence) {
                    //         // handle incoming presence events.
                    //     },
                    //     status: function(status) {
                    //         // handle incoming status events.
                    //     }
                    // });

                    // // subscribe to one or more channels
                    // pubnub.subscribe({
                    //     channels: ['mr-demo']
                    // });
                };

                // error handling function
                function handleLocationError(browserHasGeolocation) {
                    console.log(browserHasGeolocation ?
                        'Error: The Geolocation service failed.' :
                        'Error: Your browser doesn\'t support geolocation.');
                };
            }

            // random client id for pubnub connection
            // var name = "";
        </script>
    </body>
</html>
